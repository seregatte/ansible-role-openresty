---
  # OpenResty SSL configuration

- name: Create SSL key directory
  file:
    path: /etc/ssl/private
    state: directory
    mode: 0700

- name: Generate Self Signed SSL for testing
  block:
    - name: Generate self-signed key and certificate pair with OpenSSL
      command: openssl req -x509 -nodes -subj "/C=US/ST=Illinois/L=Hell/O=IT/CN=hauptj.com" -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt
      args:
        creates: /etc/ssl/certs/nginx-selfsigned.crt

    - name: Generate dhparam
      command: openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048
      args:
        creates: /etc/ssl/certs/dhparam.pem

  when: SSL_self_signed == true

#### TODO #####
# Allow import of authority signed SSL certificates
